---
title: "Example Simple-forecasts"
output:
  md_document:
    variant: markdown_github
---

```{r, include=FALSE}

library(simpleforecasts)
library(tidyverse)
library(series.4macro)
library(fable)
library(feasts)
library(tsibble)
library(seasonal)
library(tsibbledata)

```


### load_clean_series

Carrega as séries do 4macro em formato _tibble_. 
As séries são retornadas empilhadas, organizadas pela coluna sid.
Contém as colunas: sid, date, forecast, vl


```{r}
data <- simpleforecasts::load_clean_series(
  sid_vl = c(
    'BRGDP0081000ROML', #PIB 4i
    'BRRTL0021000OOML', #PMC
    'BRSER0001000OOML', #PMS
    'BRIND0001000OOML', #PIM
    'BRIND0002000OOML', #PIM Extrativa
    'BRIND0003000OOML', #PIM Transformação
    'BRFXR0031000OODL', #Cambio Diário
    'BRMTG0003JOIOAML' #Temperatura Média
    ),
  auth_path = '../auth.ini',
  estimate = F
)
```


### split_series

Recupera apenas uma das séries carregadas pela fct _load_clean_series_. 
Também permite filtrar se é desejado dado estimado ou não. 

```{r}
pib_4i <- data %>% 
  simpleforecasts::split_series(sid_vl = 'BRGDP0081000ROML')
```


### get_seas_adj

Calcula, automaticamente, a série sem efeito sazonal.
Utiliza o método X13, STL ou uma média entre eles.

```{r, message=FALSE}
pib_dessaz <- pib_4i %>% 
  get_seas_adj()
```

```{r, echo=FALSE, message=FALSE}
ggplot() +
  geom_line(data = pib_4i %>%
              rename(original = vl) %>% 
              filter(date >= '2017-01-01'),
            aes(x = date, y = original),
            color = 'black',
            size = 1) +
  geom_line(data = pib_dessaz %>%
              rename(dessaz = vl) %>% 
              filter(date >= '2017-01-01'), 
            aes(x = date, y = dessaz), 
            color = 'darkorange',
            size = 1)
```

